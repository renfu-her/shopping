{% extends "frontend_base.html" %}

{% block title %}{{ product.name }} - 購物去{% endblock %}
{% block meta_description %}{{ product.description[:160] if product.description else 'Buy ' + product.name + ' at 購物去. Quality products at great prices.' }}{% endblock %}
{% block meta_keywords %}{{ product.name }}, {{ product.category_name if product.get('category_name') else '' }}, shopwise, online shopping{% endblock %}
{% block canonical_url %}{{ url_for('frontend.product_detail', id=product.id, slug=product.slug, _external=True) if product.slug else url_for('frontend.product_detail', id=product.id, _external=True) }}{% endblock %}
{% block og_type %}product{% endblock %}
{% block og_url %}{{ url_for('frontend.product_detail', id=product.id, slug=product.slug, _external=True) if product.slug else url_for('frontend.product_detail', id=product.id, _external=True) }}{% endblock %}
{% block og_title %}{{ product.name }} - 購物去{% endblock %}
{% block og_description %}{{ product.description[:160] if product.description else 'Buy ' + product.name + ' at 購物去. Quality products at great prices.' }}{% endblock %}
{% block og_image %}{{ request.url_root }}uploads/{{ product.images[0] if product.images else 'static/images/no-image.png' }}{% endblock %}
{% block twitter_title %}{{ product.name }} - 購物去{% endblock %}
{% block twitter_description %}{{ product.description[:160] if product.description else 'Buy ' + product.name + ' at 購物去. Quality products at great prices.' }}{% endblock %}
{% block twitter_image %}{{ request.url_root }}uploads/{{ product.images[0] if product.images else 'static/images/no-image.png' }}{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.name|e }}",
  "description": "{{ (product.description or '')|e|truncate(500) }}",
  "image": [
    {% for img in product.images %}
    "{{ request.url_root }}uploads/{{ img }}"{% if not loop.last %},{% endif %}
    {% endfor %}
  ],
  "brand": {
    "@type": "Brand",
    "name": "購物去"
  },
  "offers": {
    "@type": "Offer",
    "url": "{{ url_for('frontend.product_detail', id=product.id, slug=product.slug, _external=True) if product.slug else url_for('frontend.product_detail', id=product.id, _external=True) }}",
    "priceCurrency": "USD",
    "price": "{{ product.price }}",
    "priceValidUntil": "2025-12-31",
    "availability": "https://schema.org/{% if product.stock > 0 and product.is_active %}InStock{% else %}OutOfStock{% endif %}",
    "itemCondition": "https://schema.org/NewCondition"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.5",
    "reviewCount": "10"
  }{% if product.get('category_name') %},
  "category": "{{ product.category_name|e }}"{% endif %}
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ url_for('frontend.index', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Products",
      "item": "{{ url_for('frontend.product_list', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ product.name|e }}",
      "item": "{{ url_for('frontend.product_detail', id=product.id, slug=product.slug, _external=True) if product.slug else url_for('frontend.product_detail', id=product.id, _external=True) }}"
    }
  ]
}
</script>
{% endblock %}

{% block content %}
<!-- START SECTION BREADCRUMB -->
<div class="breadcrumb_section bg_gray page-title-mini">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="page-title">
                    <h1>{{ product.name }}</h1>
                </div>
            </div>
            <div class="col-md-6">
                <ol class="breadcrumb justify-content-md-end">
                    <li class="breadcrumb-item"><a href="{{ url_for('frontend.index') }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('frontend.product_list') }}">Products</a></li>
                    <li class="breadcrumb-item active">{{ product.name }}</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- END SECTION BREADCRUMB -->

<!-- START SECTION SHOP -->
<div class="section">
    <div class="container">
        <div class="row">
            <div class="col-xl-9 col-lg-8">
                <div class="row">
                    <div class="col-lg-6 col-md-6 mb-4 mb-md-0">
                        <div class="product-image">
                            <div class="product_img_box">
                                <img id="product_img" src="/uploads/{{ product.images[0] if product.images else '' }}" alt="{{ product.name }}" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27300%27 height=%27300%27%3E%3Crect width=%27300%27 height=%27300%27 fill=%27%23f0f0f0%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27 fill=%27%23999%27 font-family=%27Arial%27 font-size=%2714%27%3E無圖片%3C/text%3E%3C/svg%3E'">
                            </div>
                            {% if product.images|length > 1 %}
                            <div id="pr_item_gallery" class="product_gallery_item">
                                {% for img in product.images %}
                                <div class="item">
                                    <a href="#" class="product_gallery_item {% if loop.first %}active{% endif %}" data-image="/uploads/{{ img }}">
                                        <img src="/uploads/{{ img }}" alt="product_small_img{{ loop.index }}" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect width=%27100%27 height=%27100%27 fill=%27%23f0f0f0%27/%3E%3C/svg%3E'">
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="pr_detail">
                            <div class="product_description">
                                <h4 class="product_title"><a href="#">{{ product.name }}</a></h4>
                                <div class="product_price">
                                    <span class="price">${{ "%.2f"|format(product.price) }}</span>
                                </div>
                                <div class="pr_desc">
                                    <p>{{ product.description or 'No description available.' }}</p>
                                </div>
                                {% if product.stock > 0 and product.is_active %}
                                <div class="cart_extra">
                                    <form method="POST" action="{{ url_for('frontend.cart_add') }}">
                                        <input type="hidden" name="product_id" value="{{ product.id }}">
                                        <div class="cart-product-quantity">
                                            <div class="quantity">
                                                <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}" class="form-control">
                                            </div>
                                        </div>
                                        <div class="cart_btn">
                                            <button type="submit" class="btn btn-fill-out btn-addtocart"><i class="icon-basket-loaded"></i> Add To Cart</button>
                                        </div>
                                    </form>
                                </div>
                                {% else %}
                                <div class="alert alert-warning">Out of Stock</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END SECTION SHOP -->
{% endblock %}

